import type { QueryResolvers } from "./../../types.generated";
import { tursoTools } from "@/src/db";

export const generationJob: NonNullable<QueryResolvers['generationJob']> = async (_parent, args, _ctx) => {
  const job = await tursoTools.getGenerationJob(args.id);
  if (!job) {
    throw new Error(`Generation job ${args.id} not found`);
  }

  return {
    id: job.id,
    userId: job.userId,
    type: job.type as any,
    goalId: job.goalId,
    storyId: job.storyId,
    status: job.status as any,
    progress: job.progress,
    result: job.result,
    error: job.error,
    createdAt: job.createdAt,
    updatedAt: job.updatedAt,
  };
};
